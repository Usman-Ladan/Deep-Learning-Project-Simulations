Testing a New Method for Computing Neural Ordinary Differential Equations
=========================================================================

## Overview
This set of files and scripts is from a project I did for a deep learning course taken from October to December of 2022. Our guide for the project was to write a 5 page report on a theoretical topic within deep learning. My project concerned _Neural Ordinary Differential Equations_ (NODEs), comparing and contrasting two novel methods (Zhi et al. (2022)[^2] and Xia et al.[^3]) that aim to speed up NODEs computation times. For the project's final section I took the method from Zhi et al. (2022)[^2], and trained the network on a "plane vibrations" dataset used in Xia et al. (2021)[^3].

## Disclaimer
Much of the code used in this project comes from the paper by Zhi et al. (2022)[^1]. The model provided came from them, and the `systems` directory contains code from their original paper unaltered, so that you can see where modifications were made. The `pv.csv` and `sb.csv` were taken from the paper by Xia et al. (2021)[^3], though the `sv.csv` dataset is not used in this project. Further details on the neural network structures used here can be found in these papers.

## File Structure
### data

This directory contains all data from the project, including the original `pv.csv` dataset, its modifications, and the data generated by training the model.

### images
This file holds all of the images generated from the models, including the loss vs. epoch graphs, and graphing the predicted outputs of the test data against their actual outputs.

### mock files
The whole pv dataset comprises just over 73,000 datapoints. Consequently, training on the whole dataset can take a matter of hours. To test the functionality of the code itself, a mock dataset of only 200 datapoints was created. This directory holds the python scripts that generate, train and test on the smaller dataset.

### real files
This directory holds similar functions to the `mock files` directory, but uses the whole dataset as opposed to the smaller one.

### systems
This directory comes directly from the paper by Zhi et al. (2022)[^1], and contains files that train their method on dynamical systems data. Specifically, data whose dymanics is governed by _the Lorentz system_ and _the Lotka-Volterra system_. See the original paper for more details. They are kept in this project simply for one to see how they have been modified for these purposes.

## How to Use
Firstly, make sure that Python version 3.9 and the following non-standard libraries are installed:

- Numpy
- Matplotlib
- PyTorch
- torchdiffeq
- FrEIA

I will outline the order in which to run the files for the mock dataset. Simply use the non-mock files if you wish to train the network on the whole dataset (**N.B training on the whole dataset will take a few hours, whilst training on the mock dataset only takes a few minutes. Only train on the whole set if you are sure you want to**). For all files, run them from the directory they are located in (`mock files` or `real files`).

1. Run `mock_data_generator.py` to generate `mock_train_data.json` and `mock_test_data.json`
2. Run `mock_pv_train_mine.py` to train the model on the mock training set
3. Run `mock_loss_plot.py` to plot how the loss changes against the number of epochs. The scale can be made logarithmic by uncommenting `plt.yscale("log")`
4. Run `mock_pv_test_mine.py` to test the trained model on the test data, and plot the actual outputs and the predicted outputs on the same graph. To generate the plots other features, change what is graphed on the y axis in lines 144 and 145 of the script. Currently, `test_force` and `predicted_force` will be plotted.

## Further Work
Due to time constraints, I was not able to perform more tests on this method or the other. In the future, it would be interesting to find more scenarios in which to test the two methods, or even try and form a hybrid of the two.

[^1]: Zhi, W., Lai, T., Ott, L., Bonilla, E. V. & Ramos, F. (2021), ‘Learning efficient and robust ordinary differential
equations via diffeomorphisms’. URL: https://openreview.net/forum?id=r9cpyzP-DQ

[^2]: Zhi, W., Lai, T., Ott, L., Bonilla, E. V. & Ramos, F. (2022), Learning efficient and robust ordinary differential equations via invertible neural networks, in ‘International Conference on Machine Learning’, PMLR,
pp. 27060–27074. URL: https://proceedings.mlr.press/v162/zhi22a.html

[^3]: Xia, H., Suliafu, V., Ji, H., Nguyen, T., Bertozzi, A., Osher, S. & Wang, B. (2021), Heavy ball neural ordinary
differential equations, in M. Ranzato, A. Beygelzimer, Y. Dauphin, P. Liang & J. W. Vaughan, eds, ‘Advances
in Neural Information Processing Systems’, Vol. 34, Curran Associates, Inc., pp. 18646–18659. URL: https://proceedings.neurips.cc/paper/2021/hash/9a86d531e19ec6f5937ad1373bb118bd-Abstract.html